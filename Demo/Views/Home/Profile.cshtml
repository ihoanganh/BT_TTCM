@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "Profile";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}
@model Tuser
    <section class="hero-wrap hero-wrap-2" style="background-image: url('../main/images/bg_3.jpg');" data-stellar-background-ratio="0.5">
      <div class="overlay"></div>
      <div class="container">
        <div class="row no-gutters slider-text align-items-end justify-content-center">
          <div class="col-md-9 ftco-animate text-center mb-4">
            <h1 class="mb-2 bread">Profile</h1>
            <p class="breadcrumbs"><span class="mr-2"><a asp-action="Index" asp-controller="Home">Home <i class="ion-ios-arrow-forward"></i></a></span> <span>Profile<i class="ion-ios-arrow-forward"></i></span></p>
          </div>
        </div>
      </div>
    </section>

   <section class="section profile">
      <div class="row">
        <div class="col-xl-4">

          <div class="card">
            <div class="card-body profile-card pt-4 d-flex flex-column align-items-center">
                @if (@ViewBag.Profile != null){
                    <img src="@Url.Content("~/Customer/" + @ViewBag.Profile.Img)"  alt="Profile" width="200px" height="200px">
                }
                else{
                    <img src="" alt="Profile" class="rounded-circle">
                }
              <h2>@Model.HoTen</h2>
              <h3>@Model.Email</h3>
              <div class="social-links mt-2">
                <a href="#" class="twitter"><i class="bi bi-twitter"></i></a>
                <a href="#" class="facebook"><i class="bi bi-facebook"></i></a>
                <a href="#" class="instagram"><i class="bi bi-instagram"></i></a>
                <a href="#" class="linkedin"><i class="bi bi-linkedin"></i></a>
              </div>
            </div>
          </div>

        </div>

        <div class="col-xl-8">

          <div class="card">
            <div class="card-body pt-3">
              <!-- Bordered Tabs -->
              <ul class="nav nav-tabs nav-tabs-bordered">

                <li class="nav-item">
                  <button class="nav-link ftco-animate active" id="v-pills-1-tab" data-toggle="pill" href="#v-pills-1" role="tab" aria-controls="v-pills-1" aria-selected="true">Overview</button>
                </li>

                <li class="nav-item">
                  <button class="nav-link ftco-animate" id="v-pills-2-tab" data-toggle="pill" href="#v-pills-2" role="tab" aria-controls="v-pills-2" aria-selected="false">Settings</button>
                </li>

                <li class="nav-item">
                  <button class="nav-link ftco-animate" id="v-pills-3-tab" data-toggle="pill" href="#v-pills-3" role="tab" aria-controls="v-pills-3" aria-selected="false">Change Password</button>
                </li>

                <li class="nav-item">
                  <button class="nav-link ftco-animate" id="v-pills-3-tab" data-toggle="pill" href="#v-pills-4" role="tab" aria-controls="v-pills-4" aria-selected="false">Order List</button>
                </li>

              </ul>
              <div class="tab-content pt-2">

                <div class="tab-pane fade show active profile-overview" id="v-pills-1">

                  <!-- Profile Edit Form -->
                  <form>
                    <div class="row mb-3">
                      <label for="profileImage" class="col-md-4 col-lg-3 col-form-label">Profile Image</label>
                      <div class="col-md-8 col-lg-9">
                           @if (@ViewBag.Profile != null){
                               <img src="@Url.Content("~/Customer/" + @ViewBag.Profile.Img)" alt="Profile" width="50px" height="50px">
              
                }
                else{
                     <img src="" alt="Profile">
                }
                      </div>
                    </div>

                    <div class="row mb-3">
                      <label for="fullName" class="col-md-4 col-lg-3 col-form-label">Full Name</label>
                      <div class="col-md-8 col-lg-9">
                        <input name="fullName" type="text" class="form-control" id="fullName" value="@Model.HoTen" readonly>
                      </div>
                    </div>

                    <div class="row mb-3">
                      <label for="Phone" class="col-md-4 col-lg-3 col-form-label">Phone</label>
                      <div class="col-md-8 col-lg-9">
                          @if(@ViewBag.Profile != null){
                         <input name="phone" type="text" class="form-control" id="Phone" value="@ViewBag.Profile.Sdt" readonly>
                    }
                   else {
                        <input name="phone" type="text" class="form-control" id="Phone" value="" readonly>
                   }
                      </div>
                    </div>

                    <div class="row mb-3">
                      <label for="Email" class="col-md-4 col-lg-3 col-form-label">Email</label>
                      <div class="col-md-8 col-lg-9">
                        <input name="email" type="email" class="form-control" id="Email" value="@Model.Email" readonly>
                      </div>
                    </div>
                  </form><!-- End Profile Edit Form -->

                </div>

                <div class="tab-pane fade pt-3" id="v-pills-2">

                  <!-- Settings Form -->
                  <form>

                    <div class="row mb-3">
                      <label for="fullName" class="col-md-4 col-lg-3 col-form-label">Email Notifications</label>
                      <div class="col-md-8 col-lg-9">
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="changesMade" checked>
                          <label class="form-check-label" for="changesMade">
                            Changes made to your account
                          </label>
                        </div>
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="newProducts" checked>
                          <label class="form-check-label" for="newProducts">
                            Information on new products and services
                          </label>
                        </div>
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="proOffers">
                          <label class="form-check-label" for="proOffers">
                            Marketing and promo offers
                          </label>
                        </div>
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="securityNotify" checked disabled>
                          <label class="form-check-label" for="securityNotify">
                            Security alerts
                          </label>
                        </div>
                      </div>
                    </div>

                    <div class="text-center">
                      <button asp-action="LogOut" asp-controller="Home"  class="btn btn-primary">LogOut</button>
                    </div>
                  </form><!-- End settings Form -->

                </div>

                <div class="tab-pane fade pt-3" id="v-pills-3">
                  <!-- Change Password Form -->
                  <form>

                    <div class="row mb-3">
                      <label for="currentPassword" class="col-md-4 col-lg-3 col-form-label">Current Password</label>
                      <div class="col-md-8 col-lg-9">
                        <input name="password" type="password" class="form-control" id="currentPassword">
                      </div>
                    </div>

                    <div class="row mb-3">
                      <label for="newPassword" class="col-md-4 col-lg-3 col-form-label">New Password</label>
                      <div class="col-md-8 col-lg-9">
                        <input name="newpassword" type="password" class="form-control" id="newPassword">
                      </div>
                    </div>

                    <div class="row mb-3">
                      <label for="renewPassword" class="col-md-4 col-lg-3 col-form-label">Re-enter New Password</label>
                      <div class="col-md-8 col-lg-9">
                        <input name="renewpassword" type="password" class="form-control" id="renewPassword">
                      </div>
                    </div>

                    <div class="text-center">
                      <input onclick="changePassWord()" class="btn btn-primary" value="Change Password" readonly></input>
                    </div>
                  </form><!-- End Change Password Form -->

                </div>
                <div class="tab-pane fade pt-3" id="v-pills-4">
                @if (ViewBag.ListHD != null){
                  <!-- Change Password Form -->
                  <table class="table">
                    <thead>
                        <tr>
                            <th>
                                ID
                            </th>
                            <th>
                                Số hóa đơn
                            </th>
                            <th>
                                Ngày đặt
                            </th>
                            <th>
                                Tổng tiền
                            </th>
                            <th></th>
                        </tr>
                    </thead>
                <tbody>
                    @foreach (HoaDonBan item in @ViewBag.ListHD) {
                            <tr>
                                <td>
                                    @item.Id
                                </td>
                                <td>
                                    @item.SoHd
                                </td>
                                <td>
                                    @item.NgayXuat
                                </td>
                                <td>
                                    @item.TongTien
                                </td>
                                <td>
                                    <button onclick="showDetails(@item.Id)" >Chi tiết hóa đơn</button>
                                </td>
                            </tr>
                    }
                        </tbody>
                    </table>
                    <br />
                    <br />
                    <br />
                    <br />
                    
                    <div id="details">
                    </div>
                
                }
                else{
                    <h2> Chưa có đơn hàng</h2>
                }
                </div>
              </div><!-- End Bordered Tabs -->

            </div>
          </div>

        </div>
      </div>
    </section>
@section Scripts{
 <script>
    function showDetails(id) {
        var url = 'https://localhost:7000/api/cart/details?id=' + id;
        console.log("")
        var str = `<h2>Chi tiết đơn hàng</h2>
        <table class="table">
                    <thead>
                        <tr>
                            <th>
                                Số lượng
                            </th>
                            <th>
                                Giá Tiền
                            </th>
                            <th>
                                Tên món ăn
                            </th
                            <th></th>
                        </tr>
                    </thead>
                <tbody>
        `;
        $.ajax({
            type: 'GET',
            url: url,
            dataType: 'json',
            success: function (data) {
                $.each(data, function (key, val) {
                    str += `
                        <tr>
                <td>
                    ${val.sl}
                </td>
                <td>
                    ${val.giaTien}
                </td>
                <td>
                     ${val.menu}
                </td>
            </tr>`
                });
                str +=`</tbody>
                    </table>`
                $('#details').html(str);
            },
            Error: function (xhr) {
                alert(xhr.reponseText)
            }
        });
    };
function changePassWord() { 

    // Create a new FormData objec
            var url = 'https://localhost:7270//api/changePassword?old_pw=' + $('#currentPassword').val() + '&new_pw=' + $('#newPassword').val() + '&check_new_pw=' + $('#renewPassword').val();
	$.ajax({
		url: url,
	    method: 'POST',
	    contentType: 'json',
	    dataType: 'json',
	    error: function (response) {
		    alert("Thay đổi mật khẩu thất bại");
		    },
	    success: function (reponse) {
            if (reponse == true){
                alert("Thay đổi mật khẩu thành công");
            }
		    else{
                alert("Mật khẩu hoặc nhập lại mật khẩu không đồng nhất");
            }
		}
	});
}
</script>
}